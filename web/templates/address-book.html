<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>AddressTrail - Dashboard</title>
    <link rel="stylesheet" href="/static/css/style.css" />
    <script src="/static/js/scripts.js"></script>
  </head>
  <body>
    <header>
      <nav class="navbar">
        <a href="/" class="title">AddressTrail</a>
        <div class="right-nav">
          <span class="right-nav-links navbar-links"
            >Welcome, {{ .Name }}!</span
          >
          <a href="/dashboard" class="right-nav-links navbar-links"
            >Dashboard</a
          >
          <a href="/" class="right-nav-links navbar-links">Manage Address</a>
          <a href="/" class="right-nav-links navbar-links">Log Out</a>
        </div>
      </nav>
    </header>
    <section class="container center-view">
      <div class="address-list-container" id="address-list-container">
        <button type="button" class="add-new-address" id="openFormBtn">
          <span class="button__label">Add New Address</span>
        </button>
      </div>
    </section>
    <script>
      fetch(
        "http://localhost:8080/api/users/addresses?userID=649f0ca8a675e19e10f56798"
      )
        .then((response) => response.json())
        .then((data) => {
          const addressListContainer = document.getElementById(
            "address-list-container"
          );

          data.reverse().forEach((address) => {
            const addressHolder = document.createElement("div");
            addressHolder.classList.add("address-holder");

            const addressLine = document.createElement("button");
            addressLine.classList.add("address-line");
            addressLine.dataset.addressId = address.AddressID;

            const streetAddressDisplay = document.createElement("div");
            streetAddressDisplay.classList.add("street-address-display");
            streetAddressDisplay.innerText = address.Street;

            const cityStateAddressDisplay = document.createElement("div");
            cityStateAddressDisplay.classList.add("city-state-address-display");

            const startDate = new Date(address.StartDate);
            const endDate = new Date(address.EndDate);

            const startMonthYear = `${startDate.toLocaleString("default", {
              month: "short",
            })} ${startDate.getFullYear()}`;
            const endMonthYear = `${endDate.toLocaleString("default", {
              month: "short",
            })} ${endDate.getFullYear()}`;

            cityStateAddressDisplay.innerText = `${address.City}, ${address.State} ${startMonthYear} - ${endMonthYear}`;

            const editIcon = document.createElement("div");
            editIcon.classList.add(
              "apply-flow-profile-item-tile__edit-icon",
              "background-color-1"
            );

            addressLine.appendChild(streetAddressDisplay);
            addressLine.appendChild(cityStateAddressDisplay);
            addressLine.appendChild(editIcon);
            addressHolder.appendChild(addressLine);
            addressListContainer.appendChild(addressHolder);
          });
        })
        .catch((error) => {
          console.error("Error fetching user addresses:", error);
        });
    </script>
  </body>
</html>
